{"id":"features/grid/virtual-scroll/strategies","title":"Strategies","contents":"<h1 id=\"virtual-scroll-strategies\"><a href=\"#virtual-scroll-strategies\" aria-hidden><span class=\"icon icon-link\"></span></a>Virtual Scroll Strategies</h1>\n<h2 id=\"built-in-strategies\"><a href=\"#built-in-strategies\" aria-hidden><span class=\"icon icon-link\"></span></a>Built-in Strategies</h2>\n<p><strong>nGrid</strong> comes with 3 built-in strategies</p>\n<ul>\n<li><strong>vScrollFixed</strong>: The size of all rows are fixed and equal.</li>\n<li><strong>vScrollAuto</strong>: The size the rows is not guaranteed to be equal.</li>\n<li><strong>vScrollDynamic</strong>: The size the rows is not guaranteed to be equal.</li>\n</ul>\n<p>And a special <strong>vScrollNone</strong> strategy which <strong>disable</strong> virtual scrolling.</p>\n<p>You can quickly attach a strategy using a directive:</p>\n<div><div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pbl-ngrid</span> <span class=\"token attr-name\">vScrollAuto</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pbl-ngrid</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pbl-ngrid</span> <span class=\"token attr-name\">vScrollFixed</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pbl-ngrid</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pbl-ngrid</span> <span class=\"token attr-name\">vScrollDynamic</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pbl-ngrid</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pbl-ngrid</span> <span class=\"token attr-name\">vScrollNone</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pbl-ngrid</span><span class=\"token punctuation\">></span></span></code></pre></div></div>\n<p>You can also apply a strategy globally, for all instances of <strong>nGrid</strong> which is why <strong>vScrollNone</strong> exists.<br>\nIn fact, by default, <strong>nGrid</strong> is configured to use the <strong>vScrollAuto</strong> strategy so <code class=\"language-text\">&lt;pbl-ngrid&gt;&lt;/pbl-ngrid&gt;</code> is similar to <code class=\"language-text\">&lt;pbl-ngrid vScrollAuto&gt;&lt;/pbl-ngrid&gt;</code></p>\n<h3 id=\"fixed-size-strategy-vscrollfixed\"><a href=\"#fixed-size-strategy-vscrollfixed\" aria-hidden><span class=\"icon icon-link\"></span></a>Fixed Size Strategy [vScrollFixed]</h3>\n<p>In most scenarios, the grid will have a fixed height fow all rows.<br>\nThis is a common scenario because the human brain works better with repetitive patterns.</p>\n<p>Fixed size strategy is simple, relative to other strategies, and predictive.<br>\nIf each row is 50px high and we have 1000 rows, the total height is 50,000px.<br>\nFind the index of the row at 20,000px is also simple, 20,000 / 50 = <strong>400</strong></p>\n<p>Fixed size strategy is simple math with no DOM interaction, no layout information is required from the DOM.<br>\nThis is why it is also has the best performance!</p>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n Fixed Size strategy is part of the \n<code class=\"language-text\">@angular/cdk/scrolling</code>\n package, wrapped and modified by \n<strong>nGrid</strong>\n</blockquote>\n<div pbl-example-view=\"pbl-fixed-size-example\"></div>\n<h3 id=\"different-height-strategies\"><a href=\"#different-height-strategies\" aria-hidden><span class=\"icon icon-link\"></span></a>Different Height Strategies</h3>\n<p>When the height of the rows are not equal, using fixed size will not work.<br>\nHere we need a different approach, one that involves sampling of the rows we have available and with them estimating the heights.<br>\nAt each scroll iteration we re-evaluate the estimations and correct where necessary, fine tuning our predication with every step.</p>\n<p>For estimations we first need data and because height's are unknown and math alone is not enough.<br>\nwe query the DOM to get the current layout, which  can be the height of the container or the height of each row.<br>\nThis is an expansive operation which is why these strategies perform slightly less then the fixed size strategy.</p>\n<p><strong>nGrid</strong> has 2 built in strategies in this category:</p>\n<ul>\n<li><strong>vScrollAuto</strong></li>\n<li><strong>vScrollDynamic</strong></li>\n</ul>\n<h4 id=\"auto-size-strategy-vscrollauto\"><a href=\"#auto-size-strategy-vscrollauto\" aria-hidden><span class=\"icon icon-link\"></span></a>Auto Size Strategy [vScrollAuto]</h4>\n<p>The Auto Size strategy is based an averaging row heights and fine-tune it on every render cycle (new rows enter the viewport).<br>\nInstead of sampling the height for each row it only samples the height of the container and divide it by the number of rows rendered.<br>\nThis returns the average size of the currently rendered rows. On each scroll it will perform a check to see if we need to add items at each edge.</p>\n<p>The use of average is the key to understand where this strategy works best and where not.\nOnce a prediction is missed the logic perform small correction, a miss means deviating from the average.<br>\nSo Auto Size works best when we might have from 0 to <strong>a lot</strong> of variations between the rows but the range of the deviation between the rows should be small.</p>\n<p>If we have a large bump (i.e. 500 px) it will notice and it will require several scroll cycles to correct and adjust to.</p>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n Auto Size strategy is part of the \n<code class=\"language-text\">@angular/cdk-experimental/scrolling</code>\n package, wrapped and modified by \n<strong>nGrid</strong>\n</blockquote>\n<div pbl-example-view=\"pbl-auto-size-example\"></div>\n<p>In the example above the <code class=\"language-text\">bio</code> column, having a lot of content, defines the final height of each row.<br>\nIt's completely random, hance perfect for an average based algorithm.</p>\n<h4 id=\"dynamic-size-strategy-vscrolldynamic\"><a href=\"#dynamic-size-strategy-vscrolldynamic\" aria-hidden><span class=\"icon icon-link\"></span></a>Dynamic Size Strategy [vScrollDynamic]</h4>\n<p>The Dynamic Size strategy assumes <strong>most rows</strong> have the same height and there are some rows which might have small or very large gaps.<br>\nYou can think of it as Fixed strategy with monitoring, making sure that rows with a different height are factored in.</p>\n<p>To do so, it starts with a default row height which you can provide and if not it is the height of the first row.<br>\nAs the user scrolls it will keep track of all rows with different heights then the default row height.  </p>\n<p>Only rows with different heights are stored and since we don't expect a lot of them it shouldn't impact performance.<br>\nThe data structure used for this is based on ordered (sorted) fixed size chunks where each chunk \"represent\" the same amount of rows.</p>\n<p>For example, for a dataset of 1000 rows with a chunk size of 50, we will have 20 chunks, ordered based on the row order.<br>\nA chunk will only store metadata about rows that have a size different then the default, otherwise they are not added/removed.<br>\nIf a chunk had a single row and it was removed, the whole chunk is removed as well.<br>\nRemoved chunks still exists virtually, but we don't need them to be able to calculate their height, it's dead simple: <code class=\"language-text\">20 rows in a chunk * default height</code><br>\nChunks with items in them cache the total height so they are also quick to measure.\nThe only \"tricky\" part is to calculate a partial range of a chunk or a range touching more then 1 chunk.</p>\n<p>Because chunks are sorted we use binary search for all of our calculations.<br>\nIf we take into account that most chunks are empty, most existing chunks have very few items and that each calculation is usually between 2 chunks\nwe can expect fast and accurate results even when working with rows with large gaps (50px vs 600px).</p>\n<p>Because the default base height is fixed this strategy will not perform well in a grid with chaotic height distribution as demonstrated in the Auto Size strategy above.</p>\n<div pbl-example-view=\"pbl-dynamic-size-example\"></div>\n<p>In the example above, a detail row is implemented (via row click) which is significantly larger then the row size.<br>\nThe Dynamic strategy captures new size additions and store them while removing size records from closed detail rows.  </p>\n<p>We are using the <a href=\"../../../built-in-plugins/detail-row\">Detail Row</a> plugin here, along with animations making\nsure (see the HTML) height updates are sampled only when animation is done.</p>\n<p>The <strong>Detail Row</strong> plugin is smart enough to let us know when animation is not requires because the row's context\nhas switched between DOM elements and the close/open event is not in place. It will instead just move the elements\nto the new row for us. Moreover, if an opened row was scrolled out of view into the virtual void it's height is\nstored and reflected in the total, once we scroll back into it, it will be rendered in an open state, again with no animation!</p>\n<blockquote class=\"warn icon\">\n<div class=\"icon-location\"></div>\n The Dynamic Strategy will reset the total size and all size marks to 0 when filtering\n</blockquote>\n<blockquote>\n<p>Moving forward, the Dynamic Strategy will update, improving it's accuracy based on experience.\nFor example, instead of using a default size we can fine-tune it to an average.</p>\n</blockquote>\n<h2 id=\"configure-a-global--default-strategy\"><a href=\"#configure-a-global--default-strategy\" aria-hidden><span class=\"icon icon-link\"></span></a>Configure A Global / Default Strategy</h2>\n<p>The global strategy set by default to all instances of <strong>nGrid</strong> is <code class=\"language-text\">vScrollAuto</code>.<br>\nIf a virtual scroll strategy is not set the global strategy will be used.</p>\n<p>You can configure the global strategy with <code class=\"language-text\">PblNgridModule.forRoot</code>:</p>\n<div><div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NgModule <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FixedSizeVirtualScrollStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular/cdk/scrolling'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PblNgridModule<span class=\"token punctuation\">,</span> NoVirtualScrollStrategy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pebula/ngrid'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// DISABLING VIRTUAL SCROLL</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    PblNgridModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token function-variable function\">defaultStrategy</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoVirtualScrollStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TablesWithoutVirtualScrollModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// FIXED SIZE VIRTUAL SCROLL</span>\n\n@<span class=\"token function\">NgModule</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  imports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    PblNgridModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      wheelMode<span class=\"token operator\">:</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// default wheel mode</span></span>      <span class=\"token function-variable function\">defaultStrategy</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FixedSizeVirtualScrollStrategy</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// Init with undefined instead of 48 to have the height automatically set from the first rendered row.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TablesWithFixedVirtualScrollModule</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span></code></pre></div></div>\n<blockquote class=\"info icon\">\n<div class=\"icon-location\"></div>\n Using \n<code class=\"language-text\">NoVirtualScrollStrategy</code>\n as the default strategy will disable virtual scroll globally unless explicitly defined per grid\n</blockquote>\n"}